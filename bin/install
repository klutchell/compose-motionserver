#!/usr/bin/env bash

# install docker
# https://docs.docker.com/engine/installation/linux/ubuntulinux/
curl -sSL get.docker.com | sh

# install docker-compose
if [ "$(uname -m)" = "armv7l" ]
then
	# https://github.com/hypriot/arm-compose
	apt-get update
	apt-get install -y apt-transport-https
	echo "deb https://packagecloud.io/Hypriot/Schatzkiste/debian/ jessie main" | sudo tee /etc/apt/sources.list.d/hypriot.list
	apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 37BBEE3F7AD95B3F
	apt-get update
	apt-get install docker-compose
else
	# install docker-compose as a container
	# https://docs.docker.com/compose/install
	# https://github.com/docker/compose
	latest_url="$(curl -s https://api.github.com/repos/docker/compose/releases | grep browser_download_url | grep "run.sh" | head -n 1 | cut -d '"' -f 4)"
	curl -L "$latest_url" > /usr/local/bin/docker-compose
	chmod +x /usr/local/bin/docker-compose
fi

# # install docker-compose as a binary
# latest_url="$(curl -s https://api.github.com/repos/docker/compose/releases | grep browser_download_url | grep "docker-compose-$(uname -s)-$(uname -m)" | head -n 1 | cut -d '"' -f 4)"
# curl -L "$latest_url" > /usr/local/bin/docker-compose
# chmod +x /usr/local/bin/docker-compose

# # install docker-compose via virtualenv and pip
# pushd "$(dirname "$0")"
# easy_install virtualenv
# virtualenv env
# env/bin/pip install docker-compose
# cp env/bin/docker-compose /usr/local/bin/docker-compose
# chmod +x /usr/local/bin/docker-compose
# popd